<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.neteye.xinzhizhu.dao.CourseDao">

	<select id="get" resultType="com.neteye.xinzhizhu.domain.CourseDO">
		select a.course_id,a.course_name,a.category_id,b.category_name,a.content,a.image_url,a.course_price,a.read_count,a.collect_count,a.buy_count,a.createtime,a.status,a.type  from sys_course a ,sys_category b where a.category_id = b.category_id and b.category_type = 1 and a.course_id = #{value}
	</select>

	<select id="list" resultType="com.neteye.xinzhizhu.domain.CourseDO">
		select a.course_id,a.course_name,a.category_id,b.category_name,a.content,a.image_url,a.course_price,a.read_count,a.collect_count,a.buy_count,a.createtime,a.status,a.type,a.order_sort   from sys_course a ,sys_category b
        <where>  
        		a.category_id = b.category_id and b.category_type = 1  and b.status=1
		  		  <if test="courseId != null and courseId != ''"> and a.course_id = #{courseId} </if>
		  		  <if test="courseName != null and courseName != ''"> and CONCAT(`course_name`,`category_name`) like '%${courseName}%'</if>
		  		  <if test="categoryId != null and categoryId != ''"> and a.category_id = #{categoryId} </if>
		  		  <if test="content != null and content != ''"> and a.content = #{content} </if>
		  		  <if test="imageUrl != null and imageUrl != ''"> and a.image_url = #{imageUrl} </if>
		  		  <if test="coursePrice != null and coursePrice != ''"> and a.course_price = #{coursePrice} </if>
		  		  <if test="readCount != null and readCount != ''"> and a.read_count = #{readCount} </if>
		  		  <if test="collectCount != null and collectCount != ''"> and a.collect_count = #{collectCount} </if>
		  		  <if test="buyCount != null and buyCount != ''"> and a.buy_count = #{buyCount} </if>
		  		  <if test="createtime != null and createtime != ''"> and a.createtime = #{createtime} </if>
		  		  <if test="status != null and status != ''"> and a.status = #{status} </if>
		  		  <if test="type != null and type != ''"> and a.type = #{type} </if>
			      <if test="orderSort != null and orderSort != ''"> and a.order_sort = #{orderSort} </if>
		  		</where>
        <choose>
            <when test="sort != null and sort.trim() != ''">
                order by ${sort} ${order}
            </when>
			<otherwise>
                order by a.order_sort desc
			</otherwise>
        </choose>
		<if test="offset != null and limit != null">
			limit #{offset}, #{limit}
		</if>
	</select>
	
 	<select id="count" resultType="int">
		select count(*) from sys_course
		 <where>  
		  		  <if test="courseId != null and courseId != ''"> and course_id = #{courseId} </if>
		  		  <if test="courseName != null and courseName != ''"> and course_name = #{courseName} </if>
		  		  <if test="categoryId != null and categoryId != ''"> and category_id = #{categoryId} </if>
		  		  <if test="content != null and content != ''"> and content = #{content} </if>
		  		  <if test="imageUrl != null and imageUrl != ''"> and image_url = #{imageUrl} </if>
		  		  <if test="coursePrice != null and coursePrice != ''"> and course_price = #{coursePrice} </if>
		  		  <if test="readCount != null and readCount != ''"> and read_count = #{readCount} </if>
		  		  <if test="collectCount != null and collectCount != ''"> and collect_count = #{collectCount} </if>
		  		  <if test="buyCount != null and buyCount != ''"> and buy_count = #{buyCount} </if>
		  		  <if test="createtime != null and createtime != ''"> and createtime = #{createtime} </if>
		  		  <if test="status != null and status != ''"> and status = #{status} </if>
		  		  <if test="type != null and type != ''"> and type = #{type} </if>
		  		</where>
	</select>
	 
	<insert id="save" parameterType="com.neteye.xinzhizhu.domain.CourseDO" useGeneratedKeys="true" keyProperty="courseId">
		insert into sys_course
		(
			`course_name`, 
			`category_id`, 
			`content`, 
			`image_url`, 
			`course_price`, 
			`read_count`, 
			`collect_count`, 
			`buy_count`, 
			`createtime`, 
			`status`,
			`type`,
			`order_sort`
		)
		values
		(
			#{courseName}, 
			#{categoryId}, 
			#{content}, 
			#{imageUrl}, 
			#{coursePrice}, 
			#{readCount}, 
			#{collectCount}, 
			#{buyCount}, 
			#{createtime}, 
			#{status},
			#{type},
			#{orderSort}
		)
	</insert>
	 
	<update id="update" parameterType="com.neteye.xinzhizhu.domain.CourseDO">
		update sys_course 
		<set>
			<if test="courseName != null">`course_name` = #{courseName}, </if>
			<if test="categoryId != null">`category_id` = #{categoryId}, </if>
			<if test="content != null">`content` = #{content}, </if>
			<if test="imageUrl != null">`image_url` = #{imageUrl}, </if>
			<if test="coursePrice != null">`course_price` = #{coursePrice}, </if>
			<if test="readCount != null">`read_count` = #{readCount}, </if>
			<if test="collectCount != null">`collect_count` = #{collectCount}, </if>
			<if test="buyCount != null">`buy_count` = #{buyCount}, </if>
			<if test="createtime != null">`createtime` = #{createtime}, </if>
			<if test="status != null">`status` = #{status},</if>
			<if test="type != null">`type` = #{type}</if>
			<if test="orderSort != null">`order_sort` = #{orderSort}</if>
		</set>
		where course_id = #{courseId}
	</update>
	
	<delete id="remove">
		delete from sys_course where course_id = #{value}
	</delete>
	
	<delete id="batchRemove">
		delete from sys_course where course_id in 
		<foreach item="courseId" collection="array" open="(" separator="," close=")">
			#{courseId}
		</foreach>
	</delete>

	<update id="updateplus" parameterType="com.neteye.xinzhizhu.domain.CourseDO">
		update sys_course 
		<set>
			<if test="readCount != null">`read_count` = `read_count`+ #{readCount}, </if>
			<if test="collectCount != null">`collect_count` = `collect_count` + #{collectCount}, </if>
			<if test="buyCount != null">`buy_count` = `buy_count` + #{buyCount}, </if>
		</set>
		where course_id = #{courseId}
	</update>
</mapper>